---
title: "CONGAS on simulated data"
author: "Salvatore Milite"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

In this vignette we present a simple inference with a simulated dataset to show how to perform inference with CONGAS and RCONGAS.
We start by creating a simulated dataset using the CONGAS generative model. 
In short the data generations step are:
* Randomly segment the genome
* Create a clone tree and set the distance between clones
* Sample CNV states according to the clonal relations
* Set the number of cells and clonal proportions
* Sample the library size parameter for each clone
* Sample the segment values using the CONGAS likelihood


```{r}
#library(Rcongas)
devtools::load_all(".")
#performs the first 3 steps
cnv_df <- Rcongas:::generate_cluster_ploidy_df(K = 2, spots = 2,tree =  generate_random_tree(2))
simul <- Rcongas:::run_simulation_generative(cnv_df, ncells = 1000, props = c(0.7,0.3), K = 2)

plot_counts.CNVSimulation(simul)

```
We can then perform CONGAS inference with just one function

```{r}

inf <-
  best_cluster(
    simul,
    "MixtureGaussian",
    1:4,
    param_list = list(
      "theta_scale" = 32,
      "theta_rate" = 32,
      "cnv_var" = 0.65
    ),
    steps = 600,
    lr = 0.05,
    method = "BIC",
    MAP = T
  )

plot_gw_cna_profiles(inf)
```

